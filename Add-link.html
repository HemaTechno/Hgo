<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>إنشاء مهمة</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f7f7f7; }
    .task { border: 1px solid #ccc; padding: 10px; margin-top: 10px; background: #fff; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>إنشاء مهمة</h2>
  <input type="text" id="title" placeholder="العنوان"><br><br>
  <textarea id="description" placeholder="الوصف"></textarea><br><br>
  
  <div id="tasks"></div>
  <button onclick="addTask()">➕ إضافة مهمة</button><br><br>

  <input type="text" id="finalLink" placeholder="رابط التحويل بعد تنفيذ المهام"><br><br>
  
  <input type="file" id="image"><br><br>
  
  <button onclick="createAll()">✅ إنشاء</button>
  <div id="result"></div>

  <script>
    // إعداد الفايربيس
    const firebaseConfig = {
  apiKey: "AIzaSyAKPlddXSZl25p9SI9H0CcPK4XSTNQXxAM",
  authDomain: "t-shirt-94ff7.firebaseapp.com",
  projectId: "t-shirt-94ff7",
  storageBucket: "t-shirt-94ff7.appspot.com",
  messagingSenderId: "367396012881",
  appId: "1:367396012881:web:3127607d5ced7678e64970"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    let taskIndex = 0;

    function addTask() {
      const div = document.createElement('div');
      div.className = 'task';
      div.innerHTML = `
        <label>المنصة:</label>
        <select class="platform">
          <option value="facebook">فيسبوك</option>
          <option value="discord">ديسكورد</option>
          <option value="telegram">تيليجرام</option>
          <option value="youtube">يوتيوب</option>
          <option value="roblox">روبلكس</option>
        </select><br>
        <label>نوع المهمة:</label>
        <input type="text" class="action" placeholder="مثلاً: اشترك في القناة"><br>
        <label>رابط المهمة:</label>
        <input type="text" class="link" placeholder="ضع الرابط هنا"><br>
      `;
      document.getElementById('tasks').appendChild(div);
    }

    async function createAll() {
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const finalLink = document.getElementById('finalLink').value.trim();
      const imageFile = document.getElementById('image').files[0];

      const taskElements = document.querySelectorAll('.task');
      const tasks = [];

      taskElements.forEach(el => {
        const platform = el.querySelector('.platform').value;
        const action = el.querySelector('.action').value.trim();
        const link = el.querySelector('.link').value.trim();
        if (platform && action && link) {
          tasks.push({ platform, action, link });
        }
      });

      let imageUrl = "";
      if (imageFile) {
        const storageRef = storage.ref('tasks/' + Date.now() + "_" + imageFile.name);
        await storageRef.put(imageFile);
        imageUrl = await storageRef.getDownloadURL();
      }

      const docRef = await db.collection("taskGroups").add({
        title,
        description,
        tasks,
        finalLink,
        imageUrl,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      const link = `view-task.html?id=${docRef.id}`;
      document.getElementById('result').innerHTML = `
        <p>✅ تم الإنشاء بنجاح!</p>
        <input type="text" value="${link}" readonly style="width: 100%">
        <button onclick="navigator.clipboard.writeText('${link}')">📋 نسخ الرابط</button>
      `;
    }
  </script>
</body>
</html>

