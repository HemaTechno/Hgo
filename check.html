<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>التحقق من المهمة</title>
  <style>
    body {
      font-family: Tahoma;
      text-align: center;
      margin-top: 50px;
    }
  </style>
</head>
<body>

<h2 id="status">جاري التحقق من المهمة...</h2>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// -------------------------
// Firebase Config
// -------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userIP = "";

// -------------------------
// الحصول على IP
// -------------------------
fetch("https://ipapi.co/json/")
  .then(r => r.json())
  .then(data => {
    userIP = data.ip;
    checkTask();
  })
  .catch(err => {
    document.getElementById("status").innerText = "خطأ أثناء الحصول على IP";
  });

// -------------------------
// التحقق من المهمة
// -------------------------
function checkTask() {

  get(ref(db, "users/" + userIP)).then(snapshot => {

    if (!snapshot.exists()) {
      document.getElementById("status").innerText = "لا توجد بيانات لك.. سيتم إعادتك!";
      setTimeout(() => {
        window.location.href = "1Blox.html";
      }, 2000);
      return;
    }

    const lastTask = snapshot.val().lastTask;

    document.getElementById("status").innerText =
      "تم تسجيل المهمة: " + lastTask + " ✓";

    // توجيه تلقائي بعد ثانيتين
    setTimeout(() => {
      window.location.href = "1Blox.html";
    }, 2000);

  });

}
</script>

</body>
</html>
