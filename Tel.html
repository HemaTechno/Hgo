<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Firebase -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
      authDomain: "hhhhhh-d4fb8.firebaseapp.com",
      databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
      projectId: "hhhhhh-d4fb8",
      storageBucket: "hhhhhh-d4fb8.appspot.com",
      messagingSenderId: "24512338206",
      appId: "1:24512338206:web:dfe045db59bd3434a2110f",
      measurementId: "G-HD4R7GNQ5H"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Telegram Init
    const tg = window.Telegram.WebApp;
    tg.expand(); 
    tg.enableClosingConfirmation();

    const user = tg.initDataUnsafe.user;
    const userId = user?.id;

    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const userInfoEl = document.getElementById("user-info");
    const coinsEl = document.getElementById("coins");
    const tasksCompletedEl = document.getElementById("tasks-completed");
    const showAdBtn = document.getElementById("showAd");
    const dailyBonusBtn = document.getElementById("daily-bonus");
    const tasksContainer = document.getElementById("tasks-container");
    const loadingEl = document.getElementById("loading");
    const errorEl = document.getElementById("error");
    const successEl = document.getElementById("success");

    // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø¹Ø¯ ÙØªØ±Ø©
    function hideAlert(alertEl, delay = 3000) {
      setTimeout(() => {
        alertEl.classList.remove('show');
      }, delay);
    }

    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
    function showError(message) {
      errorEl.textContent = message;
      errorEl.classList.add('show');
      hideAlert(errorEl);
    }

    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    function showSuccess(message) {
      successEl.textContent = message;
      successEl.classList.add('show');
      hideAlert(successEl);
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateUI(userData) {
      coinsEl.textContent = userData.coins.toLocaleString();
      tasksCompletedEl.textContent = userData.tasksCompleted.toLocaleString();
      
      userInfoEl.innerHTML = `
        <img src="${userData.photo}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="user-avatar">
        <div class="user-details">
          <h3>${userData.name}</h3>
          <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª!</p>
        </div>
      `;

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
      const now = new Date();
      const lastBonusTime = userData.lastBonusTime ? new Date(userData.lastBonusTime.seconds * 1000) : null;
      
      if (lastBonusTime) {
        const timeDiff = now - lastBonusTime;
        const hoursDiff = timeDiff / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
          dailyBonusBtn.disabled = true;
          const remainingHours = (24 - hoursDiff).toFixed(1);
          dailyBonusBtn.textContent = `Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (${remainingHours} Ø³Ø§Ø¹Ø© Ù…ØªØ¨Ù‚ÙŠØ©)`;
        } else {
          dailyBonusBtn.disabled = false;
          dailyBonusBtn.textContent = "ğŸ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©";
        }
      } else {
        dailyBonusBtn.disabled = false;
        dailyBonusBtn.textContent = "ğŸ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©";
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function loadUserData() {
      if (!userId) {
        showError("Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!");
        return null;
      }

      try {
        const userRef = doc(db, "users", String(userId));
        const snap = await getDoc(userRef);

        if (!snap.exists()) {
          // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
          const newUserData = {
            name: user.first_name,
            photo: user.photo_url || "https://via.placeholder.com/150",
            coins: 0,
            balance: 0,
            tasksCompleted: 0,
            date: new Date().toISOString().split("T")[0],
            lastBonusTime: null,
            lastReward: null,
            lastTaskTime: null,
            createdAt: serverTimestamp()
          };
          
          await setDoc(userRef, newUserData);
          showSuccess(`Ø£Ù‡Ù„Ø§Ù‹ ${user.first_name} ğŸ‘‹ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­`);
          return newUserData;
        } else {
          return snap.data();
        }
      } catch (error) {
        console.error("Error loading user data:", error);
        showError("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        return null;
      }
    }

    // Ù…Ù†Ø­ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    async function grantDailyBonus() {
      if (!userId) return;
      
      try {
        const userRef = doc(db, "users", String(userId));
        await updateDoc(userRef, {
          coins: increment(50),
          lastBonusTime: serverTimestamp()
        });
        
        showSuccess("ğŸ‰ Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 50 Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© ÙƒÙ…ÙƒØ§ÙØ£Ø© ÙŠÙˆÙ…ÙŠØ©!");
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const userData = await loadUserData();
        if (userData) updateUI(userData);
      } catch (error) {
        console.error("Error granting daily bonus:", error);
        showError("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ù†Ø­ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©");
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    async function initApp() {
      loadingEl.style.display = 'block';
      
      const userData = await loadUserData();
      if (userData) {
        updateUI(userData);
        loadingEl.style.display = 'none';
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      dailyBonusBtn.addEventListener("click", grantDailyBonus);
      
      showAdBtn.addEventListener("click", () => {
        // AdsGram Integration
        if (typeof Adsgram !== 'undefined') {
          const adController = window.Adsgram.init({ blockId: "int-14053" });
          
          adController.show().then(() => {
            // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
            if (userId) {
              const userRef = doc(db, "users", String(userId));
              updateDoc(userRef, {
                coins: increment(10),
                tasksCompleted: increment(1)
              }).then(() => {
                showSuccess("âœ… ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª 10 Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ©");
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                loadUserData().then(userData => {
                  if (userData) updateUI(userData);
                });
              });
            }
          }).catch((e) => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:", e);
            showError("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªØªÙˆÙØ± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.");
          });
        } else {
          showError("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹.");
        }
      });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', initApp);
  </script>

  <!-- AdsGram SDK -->
  <script src="https://adsgram.ai/js/ads.js"></script>
  
  <style>
    :root {
      --primary-color: #ff9800;
      --secondary-color: #ff5722;
      --dark-bg: #1a1a1a;
      --card-bg: #252525;
      --text-color: #ffffff;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--dark-bg);
      color: var(--text-color);
      padding: 0;
      margin: 0;
      line-height: 1.6;
    }
    
    .container {
      max-width: 100%;
      padding: 15px;
    }
    
    header {
      text-align: center;
      padding: 15px 0;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: 0 0 20px 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    
    .user-card {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .user-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-left: 15px;
      border: 3px solid var(--primary-color);
    }
    
    .user-details h3 {
      margin: 0;
      font-size: 1.2rem;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary-color);
      margin: 5px 0;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .actions-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    
    .btn i {
      margin-left: 8px;
    }
    
    .alert {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 20px;
      border-radius: 8px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
      max-width: 90%;
      text-align: center;
    }
    
    .alert.show {
      opacity: 1;
    }
    
    .alert.error {
      background: #f44336;
      color: white;
    }
    
    .alert.success {
      background: #4caf50;
      color: white;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    footer {
      text-align: center;
      padding: 20px 0;
      font-size: 0.8rem;
      opacity: 0.7;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h1>
  </header>
  
  <div class="container">
    <div class="user-card" id="user-info">
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
      </div>
    </div>
    
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-value" id="coins">0</div>
        <div class="stat-label">Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value" id="tasks-completed">0</div>
        <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
      </div>
    </div>
    
    <div class="actions-container">
      <button class="btn" id="showAd">
        <i>ğŸ¥</i> Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† (+10 Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ©)
      </button>
      
      <button class="btn" id="daily-bonus">
        <i>ğŸ</i> Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
      </button>
    </div>
  </div>
  
  <div class="alert error" id="error"></div>
  <div class="alert success" id="success"></div>
  
  <footer>
    <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2023</p>
  </footer>
</body>
</html>


