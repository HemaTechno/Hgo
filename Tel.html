
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مشاهدة إعلان — AdsGram x Telegram Mini App</title>
  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- AdsGram SDK (vanilla JS) -->
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <style>
    :root {
      --bg: #0f1115;
      --card: #151922;
      --text: #e8ebf0;
      --muted: #a8b3c7;
      --accent: #22c55e;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg); color: var(--text);
      display: grid; place-items: center;
    }
    .wrap { width: min(680px, 92vw); }
    .card {
      background: var(--card); border-radius: 20px; padding: 22px; box-shadow: 0 10px 30px rgb(0 0 0 / 30%);
    }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p { margin: 0 0 16px; color: var(--muted); line-height: 1.6; }
    .actions { display: flex; gap: 10px; align-items: center; }
    button {
      appearance: none; border: 0; border-radius: 14px; padding: 12px 18px; font-weight: 700; cursor: pointer;
    }
    #watchAdBtn { background: var(--accent); color: #052e13; }
    #watchAdBtn[disabled] { opacity: .6; cursor: not-allowed; }
    .pill { padding: 8px 12px; border-radius: 999px; font-size: 13px; }
    .pill.ok { background: rgb(34 197 94 / 18%); color: #6ee7b7; }
    .pill.err { background: rgb(239 68 68 / 15%); color: #fecaca; }
    .hidden { display: none; }
    a.cta { color: var(--accent); text-decoration: none; font-weight: 700; }
    .footer { margin-top: 14px; font-size: 12px; color: var(--muted); opacity: .8; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>شاهد إعلان واحصل على المكافأة</h1>
      <p>بالضغط على الزر بالأسفل سيتم عرض إعلان <strong>AdsGram</strong>. بعد المشاهدة حتى النهاية سيتم فتح المكافأة.</p>
      <div class="actions">
        <button id="watchAdBtn">▶️ شاهد الإعلان</button>
        <span id="status" class="pill hidden"></span>
      </div>
      <div id="reward" class="hidden" style="margin-top:14px">
        <p class="pill ok">✅ تهانينا! تم فتح المكافأة.</p>
        <!-- عدّل الرابط التالي بما يناسبك -->
        <p><a id="rewardLink" class="cta" href="#" target="_blank" rel="noopener">افتح المكافأة الآن</a></p>
      </div>
      <div id="errorBox" class="hidden" style="margin-top:14px">
        <p class="pill err">⚠️ حدث خطأ أثناء عرض الإعلان. حاول مرة أخرى لاحقًا.</p>
      </div>
      <div class="footer">Mini App يعمل داخل تليجرام. لو فتحته من المتصفح قد لا تظهر الإعلانات.</div>
    </div>
  </div>

  <script>
    // ===== Telegram Mini App bootstrapping =====
    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg) {
      tg.ready();
      try { tg.expand(); } catch (e) {}
      // موازنة الألوان حسب ثيم تليجرام
      const theme = tg.themeParams || {};
      if (theme.bg_color) document.body.style.background = theme.bg_color;
    }

    // ===== AdsGram init =====
    const blockId = 'int-14053'; // <-- blockId الذي أعطيتني إياه
    let AdController = null;
    try {
      AdController = window.Adsgram.init({ blockId });
    } catch (e) {
      console.warn('AdsGram init failed:', e);
    }

    // ===== UI helpers =====
    const btn = document.getElementById('watchAdBtn');
    const status = document.getElementById('status');
    const reward = document.getElementById('reward');
    const rewardLink = document.getElementById('rewardLink');
    const errorBox = document.getElementById('errorBox');

    function setStatus(text, kind) {
      status.textContent = text;
      status.className = `pill ${kind || ''}`;
      status.classList.remove('hidden');
    }
    function clearStatus() {
      status.classList.add('hidden');
    }

    // عدّل رابط المكافأة كما تريد (مثلاً رابط تنزيل أو صفحة خاصة)
    rewardLink.href = 'https://t.me/';

    // ===== Show ad on click (Rewarded logic) =====
    btn.addEventListener('click', async () => {
      clearStatus(); errorBox.classList.add('hidden'); reward.classList.add('hidden');
      btn.disabled = true;
      if (tg && tg.HapticFeedback) {
        try { tg.HapticFeedback.impactOccurred('light'); } catch (e) {}
      }
      if (!AdController || !AdController.show) {
        setStatus('المكوّن غير جاهز', 'err');
        btn.disabled = false; return;
      }
      setStatus('جارٍ تحميل الإعلان…', '');
      try {
        const result = await AdController.show();
        // في rewarded: يتحقق done && !error عندما يشاهد المستخدم حتى النهاية
        // في interstitial: تتحقق حتى لو أغلق الإعلان — اعمل منطقك حسب نوع البلوك
        if (result && result.done && !result.error) {
          setStatus('تمت المشاهدة ✔', 'ok');
          reward.classList.remove('hidden');
          if (tg && tg.HapticFeedback) try { tg.HapticFeedback.notificationOccurred('success'); } catch (e) {}
        } else {
          setStatus('لم تكتمل المشاهدة', 'err');
        }
      } catch (err) {
        console.warn('Ads error', err);
        errorBox.classList.remove('hidden');
        setStatus('خطأ أثناء التشغيل', 'err');
        if (tg && tg.HapticFeedback) try { tg.HapticFeedback.notificationOccurred('error'); } catch (e) {}
      } finally {
        btn.disabled = false;
      }
    });

    // تحذير خفيف عند التشغيل خارج تليجرام (لأغراض الاختبار)
    if (!tg) {
      console.info('يُفضَّل فتح هذا الملف داخل تليجرام عبر زر web_app في البوت.');
    }
  </script>
</body>
</html>
