<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg,#141e30,#243b55);
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 20px;
      margin: 15px auto;
      max-width: 400px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    button {
      background: #00c6ff;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      margin-top: 10px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #0072ff; }
    .task { margin: 10px 0; }
    #adStatus { margin-top: 10px; font-size: 14px; color: #ffd700; }
  </style>
</head>
<body>
  <h1>ğŸ¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª</h1>
  <div class="card" id="userCard">
    <h2>ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
    <p><strong>ID:</strong> <span id="telegramId">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="telegramName">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
  </div>

  <div class="card">
    <h2>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
    <div id="tasksList">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</div>
  </div>

  <div class="card">
    <h2>ğŸ¥ Ø¥Ø¹Ù„Ø§Ù† ÙˆÙ…ÙƒØ§ÙØ£Ø©</h2>
    <button id="watchAdBtn">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù†</button>
    <div id="adStatus"></div>
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
      authDomain: "hhhhhh-d4fb8.firebaseapp.com",
      databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
      projectId: "hhhhhh-d4fb8",
      storageBucket: "hhhhhh-d4fb8.appspot.com",
      messagingSenderId: "24512338206",
      appId: "1:24512338206:web:dfe045db59bd3434a2110f",
      measurementId: "G-HD4R7GNQ5H"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Telegram WebApp init
    const tg = window.Telegram.WebApp;
    tg.expand();

    const userIdEl = document.getElementById("telegramId");
    const userNameEl = document.getElementById("telegramName");

    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const user = tg.initDataUnsafe.user;
      userIdEl.textContent = user.id;
      userNameEl.textContent = user.first_name + (user.last_name ? " " + user.last_name : "");
      // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase
      firebase.database().ref("users/" + user.id).set({
        id: user.id,
        name: user.first_name + (user.last_name ? " " + user.last_name : ""),
        username: user.username || "",
        timestamp: Date.now()
      });
    } else {
      userIdEl.textContent = "ØºÙŠØ± Ù…ØªØ§Ø­";
      userNameEl.textContent = "ØºÙŠØ± Ù…ØªØ§Ø­";
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    const tasksList = document.getElementById("tasksList");
    db.ref("tasks").on("value", snap => {
      tasksList.innerHTML = "";
      if (!snap.exists()) {
        tasksList.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
        return;
      }
      snap.forEach(taskSnap => {
        const task = taskSnap.val();
        const div = document.createElement("div");
        div.className = "task";
        div.innerHTML = `
          <p><strong>${task.title}</strong></p>
          <p>${task.description}</p>
          <button onclick="window.open('${task.link}','_blank')">ØªÙ†ÙÙŠØ°</button>
        `;
        tasksList.appendChild(div);
      });
    });

  </script>

  <!-- ===== AdsGram loader & handler ===== -->
  <script>
  (async function(){
    const SDK_URLS = [
      'https://sad.adsgram.ai/js/sad.min.js',
      'https://adsgram.ai/js/adsgram.js'
    ];
    const blockId = 'int-14053';
    const statusEl = document.getElementById('adStatus');
    const watchBtn = document.getElementById('watchAdBtn');

    function logStatus(msg){
      console.log('[AdsGram] ', msg);
      statusEl.textContent = msg;
    }

    async function loadSdk(){
      for (const url of SDK_URLS){
        try{
          await new Promise((res,rej)=>{
            const s=document.createElement('script');
            s.src=url; s.async=true;
            s.onload=()=>res();
            s.onerror=()=>rej();
            document.head.appendChild(s);
          });
          if (window.Adsgram || window.sad) return;
        }catch(e){ console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„',url); }
      }
      throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ SDK");
    }

    function initSdk(){
      if (window.Adsgram) return window.Adsgram.init({blockId});
      if (window.sad) return window.sad.init({blockId});
      throw new Error("Ù„Ù… Ø£Ø¬Ø¯ init");
    }

    try {
      logStatus("ØªØ­Ù…ÙŠÙ„ SDK...");
      await loadSdk();
      window.AdController = initSdk();
      logStatus("SDK Ø¬Ø§Ù‡Ø².");
    } catch(e){
      logStatus("Ø®Ø·Ø£ SDK: "+e.message);
      return;
    }

    watchBtn.onclick = async ()=>{
      watchBtn.disabled=true;
      logStatus("ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†...");
      try{
        const result = await window.AdController.show();
        console.log("Ad result:",result);
        if (result && result.done) {
          logStatus("âœ” ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©");
        } else {
          logStatus("Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù… ÙŠÙƒØªÙ…Ù„.");
        }
      }catch(err){
        console.error(err);
        logStatus("Ø®Ø·Ø£: "+err.message);
      }
      watchBtn.disabled=false;
    };
  })();
  </script>
</body>
</html>




