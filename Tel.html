<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini App Coins</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col min-h-screen">

  <!-- Header -->
  <header class="bg-gray-800 p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">🚀 Mini App</h1>
    <div id="coinsBox" class="bg-blue-600 px-4 py-1 rounded-full">🪙 0</div>
  </header>

  <!-- Pages -->
  <main id="pageTasks" class="flex-1 p-6 text-center">
    <div class="bg-gray-800 rounded-2xl p-6 shadow-lg space-y-4">
      <h2 class="text-lg">🎥 المهام اليومية</h2>
      <div class="w-full bg-gray-700 rounded-full h-2">
        <div id="progressBar" class="bg-blue-500 h-2 rounded-full w-0"></div>
      </div>
      <p id="taskInfo">0 / 100 إعلان اليوم</p>
      <button id="watchAdBtn" class="bg-blue-600 px-4 py-2 rounded-xl">🎥 شاهد إعلان</button>
    </div>
  </main>

  <!-- Monetag SDK -->
  <script>
    let monetagReady = false;

    // نضيف السكربت بشكل ديناميكي
    const script = document.createElement("script");
    script.src = "//libtl.com/sdk.js";
    script.setAttribute("data-zone", "9747739");
    script.setAttribute("data-sdk", "show_9747739");
    script.onload = () => {
      monetagReady = true;
      console.log("✅ Monetag SDK Loaded");
    };
    script.onerror = () => {
      console.error("❌ Monetag SDK failed to load");
    };
    document.body.appendChild(script);
  </script>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
    authDomain: "hhhhhh-d4fb8.firebaseapp.com",
    projectId: "hhhhhh-d4fb8",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // User Data
  let coins = 0;
  let tasksToday = 0;
  const DAILY_LIMIT = 100;
  const userId = "guest";

  function updateUI() {
    document.getElementById("coinsBox").textContent = "🪙 " + coins;
    document.getElementById("taskInfo").textContent = tasksToday + "/" + DAILY_LIMIT + " إعلان اليوم";
    document.getElementById("progressBar").style.width = (tasksToday/DAILY_LIMIT*100)+"%";
  }

  // زر مشاهدة الإعلان
  document.getElementById("watchAdBtn").addEventListener("click", async () => {
    if (tasksToday >= DAILY_LIMIT) return alert("❌ وصلت الحد اليومي");

    if (!monetagReady || typeof window.show_9747739 !== "function") {
      console.warn("⚠️ Monetag SDK مش جاهز");
      return alert("الإعلان لسه بيجهز.. جرّب تاني بعد شوية");
    }

    const btn = document.getElementById("watchAdBtn");
    btn.disabled = true;
    btn.textContent = "⏳ جاري عرض الإعلان...";

    try {
      // شغل الإعلان
      window.show_9747739({
        type: 'inApp',
        inAppSettings: { interval: 5 }
      });
      console.log("🎥 Ad shown");

      // مدة المشاهدة
      setTimeout(async () => {
        coins++;
        tasksToday++;
        updateUI();
        alert("✅ كسبت 1 كوين بعد مشاهدة الإعلان");
        btn.disabled = false;
        btn.textContent = "🎥 شاهد إعلان";
      }, 15000); // 15 ثانية بدل 30 للتجربة
    } catch (err) {
      console.error("❌ Error showing ad:", err);
      alert("حصل خطأ أثناء عرض الإعلان");
      btn.disabled = false;
      btn.textContent = "🎥 شاهد إعلان";
    }
  });

  updateUI();
</script>
</body>
</html>



