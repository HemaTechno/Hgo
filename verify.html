<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firebase Verify</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }
    .message {
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    .warning {
      background-color: #fff3cd;
      color: #856404;
    }
    .loading {
      background-color: #e2e3e5;
      color: #383d41;
    }
  </style>
</head>
<body>
  <h1>التحقق من ربط الحساب</h1>
  <div id="message" class="message loading">جاري التحميل...</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // إعدادات Firebase - استبدلها بقيم مشروعك
    const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};

    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = 'message ' + type;
    }

    async function initFirebase() {
      try {
        // التحقق من وجود Firebase
        if (typeof firebase === 'undefined') {
          throw new Error('Firebase لم يتم تحميله');
        }

        // تهيئة Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // تمكين وضع عدم الاتصال (اختياري)
        db.enablePersistence().catch(err => {
          console.warn('لا يمكن تمكين وضع عدم الاتصال:', err);
        });

        // جلب معرّف المستخدم من الرابط
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user');

        if (!userId) {
          showMessage('⚠️ يرجى إضافة معرّف المستخدم في الرابط (?user=YOUR_ID)', 'warning');
          return;
        }

        // محاولة الاتصال مع مهلة زمنية
        const timeoutPromise = new Promise((_, reject) => 
          setTimeout(() => reject(new Error('انتهت مهلة الاتصال')), 10000)
        );

        const docPromise = db.collection("users").doc(userId).get();
        
        const doc = await Promise.race([docPromise, timeoutPromise]);

        if (doc.exists) {
          showMessage(`✅ الحساب موجود: ${JSON.stringify(doc.data())}`, 'success');
        } else {
          showMessage('❌ الحساب غير موجود', 'error');
        }
      } catch (err) {
        console.error('حدث خطأ:', err);
        
        if (err.code === 'permission-denied') {
          showMessage('❌ ليس لديك صلاحية الوصول إلى البيانات', 'error');
        } else if (err.code === 'unavailable') {
          showMessage('❌ لا يمكن الاتصال بخادم Firebase. يرجى التحقق من اتصال الإنترنت', 'error');
        } else if (err.message.includes('انتهت مهلة الاتصال')) {
          showMessage('❌ انتهت مهلة الاتصال بالخادم', 'error');
        } else {
          showMessage(`❌ حدث خطأ: ${err.message}`, 'error');
        }
      }
    }

    // بدء التطبيق
    document.addEventListener('DOMContentLoaded', initFirebase);
  </script>
</body>
</html>
